<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Mapa Procedural</title>
    <style>
        canvas {
            border: 1px solid black;
            background: #fafafa;
        }
    </style>
    <script src="geracao.js"></script> 
</head>
<body>
    
<canvas id="mapa" width="600" height="600"></canvas>
<canvas id="layoutSala" width="400" height="400" style="border:1px solid black;"></canvas>

<div>    
    <label for="myInput">Seed:</label>
    <input type="numberInput" id="seedInput" value="1234">
    <button onclick="regerar(document.getElementById('seedInput').value)">recarregar</button>
</div>

<p>
ðŸŽ¨ Legenda:
ðŸ”µ inicial
âš« final
ðŸŸ¡ tesouro
ðŸŸ¢ corredor
ðŸŸ£ puzzle
ðŸ”´ inimigos
ðŸŸ  miniboss
</p>

<script>



function desenharMapa(salas) {
    const canvas = document.getElementById("mapa");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const raio = 200;
    const anguloStep = (2 * Math.PI) / salas.length;

    salas.forEach((sala, i) => {
        sala.pos.x = centerX + raio * Math.cos(i * anguloStep);
        sala.pos.y = centerY + raio * Math.sin(i * anguloStep);
    });

    ctx.lineWidth = 2;
    for (const sala of salas) {
        for (const viz of sala.vizinhas) {
            if (sala.id < viz.sala.id) {
                ctx.beginPath();
                ctx.strokeStyle = viz.travada ? "red" : "#999";
                ctx.moveTo(sala.pos.x, sala.pos.y);
                ctx.lineTo(viz.sala.pos.x, viz.sala.pos.y);
                ctx.stroke();
                if (viz.travada && viz.chaveId) {
                    const mx = (sala.pos.x + viz.sala.pos.x) / 2;
                    const my = (sala.pos.y + viz.sala.pos.y) / 2;
                    ctx.fillStyle = "black";
                    ctx.font = "14px sans-serif";
                    ctx.textAlign = "center";
                    ctx.fillText(`ðŸ”’${viz.chaveId.split('_')[1]}`, mx, my);
                }
            }
        }
    }

    const cores = {
        inicial: "blue",
        final: "black",
        tesouro: "gold",
        corredor: "green",
        puzzle: "purple",
        inimigos: "crimson",
        normal: "#aaa",
        miniboss: "orange"
    };

    for (const sala of salas) {
        ctx.beginPath();
        ctx.fillStyle = cores[sala.tipo] || "gray";
        ctx.arc(sala.pos.x, sala.pos.y, 15, 0, 2 * Math.PI);
        ctx.fill();
        ctx.strokeStyle = "black";
        ctx.stroke();

        ctx.fillStyle = "white";
        ctx.font = "10px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText(sala.id, sala.pos.x, sala.pos.y + 3);

        if (sala.chaves.length > 0) {
            let txt = "";
            for(let i=0; i<sala.chaves.length; i++) 
                txt += sala.chaves[i].split('_')[1] + " ";
            ctx.fillStyle = "black";
            ctx.font = "14px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText(`ðŸ”‘${txt}`, sala.pos.x, sala.pos.y - 20);
        }
    }

    canvas.onclick = function (e) {
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        for (const sala of salas) {
            const dx = sala.pos.x - x;
            const dy = sala.pos.y - y;
            if (dx * dx + dy * dy < 15 * 15) {
                desenharSalaDetalhada(sala);
                break;
            }
        }
    };
}

// Desenha matriz de tiles considerando todos os tipos
function desenharSalaDetalhada(sala) {
    const canvas = document.getElementById("layoutSala");
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    const H = sala.map.length;
    const W = sala.map[0].length;
    const tileSize = canvas.width / Math.max(W, H);

    for (let y = 0; y < H; y++) {
        for (let x = 0; x < W; x++) {
            const tile = sala.map[y][x];
            let fill = "#000";
            switch (tile) {
                case TILES.WALL:
                    fill = {
                        caverna: "#444", floresta: "#2e5c2e",
                        pantano: "#2c3f48", deserto: "#d2b48c",
                        ruins: "#555", volcano: "#333"
                    }[sala.bioma] || "#444";
                    break;
                case TILES.FLOOR:
                    fill = { caverna: "#888", floresta: "#cce5cc",
                        pantano: "#99aabb", deserto: "#f4e4b2",
                        ruins: "#aaa", volcano: "#aa5500"
                    }[sala.bioma] || "#888";
                    break;
                case TILES.TREE: fill = "#228b22"; break;
                case TILES.WATER: fill = "#336677"; break;
                case TILES.MUD: fill = "#553"; break;
                case TILES.SAND: fill = "#ffe4a1"; break;
                case TILES.ROCK: fill = "#555555"; break;
                case TILES.BRICK: fill = "#aa7f4d"; break;
                case TILES.RUBBLE: fill = "#888"; break;
                case TILES.LAVA: fill = "#cc3300"; break;
                case TILES.ASH: fill = "#666666"; break;
                case TILES.DOOR: fill = "#ff9900"; break;
                default: fill = "#f00"; break;
            }
            ctx.fillStyle = fill;
            ctx.fillRect(x * tileSize, y * tileSize, tileSize, tileSize);
            ctx.strokeStyle = "#000";
            ctx.strokeRect(x * tileSize, y * tileSize, tileSize, tileSize);
        }
    }
}

function regerar(seed){
    salas = gerarMapa(seed);
    desenharMapa(salas);
    mostrarMapa(salas);
    desenharSalaDetalhada(salas[0]);
}

regerar(1234);

</script>
</body>
</html>
